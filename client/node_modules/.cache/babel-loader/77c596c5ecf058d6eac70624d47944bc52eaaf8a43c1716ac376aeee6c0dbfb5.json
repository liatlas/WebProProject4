{"ast":null,"code":"import axios from \"axios\";\nconst API_BASE_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Create axios instance with defaults\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  },\n  timeout: 10000\n});\n\n// Request interceptor - add auth token\napiClient.interceptors.request.use(config => {\n  const token = localStorage.getItem(\"authToken\");\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Response interceptor - handle errors\napiClient.interceptors.response.use(response => response.data, error => {\n  if (error.response) {\n    // Handle token expiration\n    if (error.response.status === 401 && error.response.data.expired) {\n      // Try to refresh token\n      return refreshTokenAndRetry(error.config);\n    }\n\n    // Handle other errors\n    const message = error.response.data.message || \"An error occurred\";\n    return Promise.reject(new Error(message));\n  } else if (error.request) {\n    return Promise.reject(new Error(\"No response from server\"));\n  } else {\n    return Promise.reject(new Error(\"Request setup error\"));\n  }\n});\n\n/**\n * Refresh token and retry failed request\n */\nasync function refreshTokenAndRetry(originalRequest) {\n  try {\n    const refreshToken = localStorage.getItem(\"refreshToken\");\n    if (!refreshToken) throw new Error(\"No refresh token\");\n    const response = await axios.post(`${API_BASE_URL}/auth/refresh`, {\n      refreshToken\n    });\n    const newToken = response.data.token;\n    localStorage.setItem(\"authToken\", newToken);\n\n    // Retry original request\n    originalRequest.headers.Authorization = `Bearer ${newToken}`;\n    return axios(originalRequest);\n  } catch (error) {\n    // Refresh failed, logout user\n    localStorage.removeItem(\"authToken\");\n    localStorage.removeItem(\"refreshToken\");\n    window.location.href = \"/\";\n    return Promise.reject(error);\n  }\n}\nexport const authAPI = {\n  register: (username, email, password, displayName) => apiClient.post(\"/auth/register\", {\n    username,\n    email,\n    password,\n    displayName\n  }),\n  login: (username, password) => apiClient.post(\"/auth/login\", {\n    username,\n    password\n  }),\n  refresh: refreshToken => apiClient.post(\"/auth/refresh\", {\n    refreshToken\n  }),\n  verify: () => apiClient.get(\"/auth/verify\")\n};\nexport const userAPI = {\n  getProfile: userId => apiClient.get(`/users/${userId}`),\n  updateProfile: updates => apiClient.put(\"/users/profile\", updates),\n  getStats: userId => apiClient.get(`/users/${userId}/stats`),\n  getHistory: (userId, limit = 50) => apiClient.get(`/users/${userId}/history?limit=${limit}`),\n  getPreferences: () => apiClient.get(\"/users/preferences\"),\n  updatePreferences: preferences => apiClient.put(\"/users/preferences\", preferences),\n  unlockTheme: themeName => apiClient.post(`/users/themes/${themeName}`)\n};\nexport const gameAPI = {\n  create: (boardSize, gameMode, opponentId = null) => apiClient.post(\"/games/create\", {\n    boardSize,\n    gameMode,\n    opponentId\n  }),\n  get: sessionId => apiClient.get(`/games/${sessionId}`),\n  complete: (sessionId, data) => apiClient.post(`/games/${sessionId}/complete`, data),\n  recordMove: (sessionId, moveData) => apiClient.post(`/games/${sessionId}/moves`, moveData),\n  getMoves: sessionId => apiClient.get(`/games/${sessionId}/moves`)\n};\nexport const leaderboardAPI = {\n  get: (category, season = \"all_time\", limit = 100) => apiClient.get(`/leaderboards/${category}?season=${season}&limit=${limit}`),\n  getPosition: (category, season = \"all_time\") => apiClient.get(`/leaderboards/${category}/position?season=${season}`)\n};\nexport const achievementAPI = {\n  getAll: () => apiClient.get(\"/achievements\"),\n  getUserAchievements: userId => apiClient.get(`/users/${userId}/achievements`)\n};\nexport const powerupAPI = {\n  getAll: () => apiClient.get(\"/powerups\"),\n  getUserPowerups: () => apiClient.get(\"/users/powerups\"),\n  use: powerupKey => apiClient.post(`/powerups/${powerupKey}/use`)\n};\nexport const analyticsAPI = {\n  getSystemStats: () => apiClient.get(\"/analytics/system\")\n};\n\n/**\n * Save auth tokens to localStorage\n */\nexport function saveTokens(token, refreshToken) {\n  localStorage.setItem(\"authToken\", token);\n  localStorage.setItem(\"refreshToken\", refreshToken);\n}\n\n/**\n * Remove auth tokens from localStorage\n */\nexport function clearTokens() {\n  localStorage.removeItem(\"authToken\");\n  localStorage.removeItem(\"refreshToken\");\n}\n\n/**\n * Check if user is authenticated\n */\nexport function isAuthenticated() {\n  return !!localStorage.getItem(\"authToken\");\n}\n\n/**\n * Get current auth token\n */\nexport function getToken() {\n  return localStorage.getItem(\"authToken\");\n}\nexport default apiClient;","map":{"version":3,"names":["axios","API_BASE_URL","process","env","REACT_APP_API_URL","apiClient","create","baseURL","headers","timeout","interceptors","request","use","config","token","localStorage","getItem","Authorization","error","Promise","reject","response","data","status","expired","refreshTokenAndRetry","message","Error","originalRequest","refreshToken","post","newToken","setItem","removeItem","window","location","href","authAPI","register","username","email","password","displayName","login","refresh","verify","get","userAPI","getProfile","userId","updateProfile","updates","put","getStats","getHistory","limit","getPreferences","updatePreferences","preferences","unlockTheme","themeName","gameAPI","boardSize","gameMode","opponentId","sessionId","complete","recordMove","moveData","getMoves","leaderboardAPI","category","season","getPosition","achievementAPI","getAll","getUserAchievements","powerupAPI","getUserPowerups","powerupKey","analyticsAPI","getSystemStats","saveTokens","clearTokens","isAuthenticated","getToken"],"sources":["/home/atlas/puzzle/client/src/utils/apiClient.js"],"sourcesContent":["import axios from \"axios\";\n\nconst API_BASE_URL =\n  process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Create axios instance with defaults\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n  timeout: 10000,\n});\n\n// Request interceptor - add auth token\napiClient.interceptors.request.use(\n  (config) => {\n    const token = localStorage.getItem(\"authToken\");\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  },\n);\n\n// Response interceptor - handle errors\napiClient.interceptors.response.use(\n  (response) => response.data,\n  (error) => {\n    if (error.response) {\n      // Handle token expiration\n      if (error.response.status === 401 && error.response.data.expired) {\n        // Try to refresh token\n        return refreshTokenAndRetry(error.config);\n      }\n\n      // Handle other errors\n      const message = error.response.data.message || \"An error occurred\";\n      return Promise.reject(new Error(message));\n    } else if (error.request) {\n      return Promise.reject(new Error(\"No response from server\"));\n    } else {\n      return Promise.reject(new Error(\"Request setup error\"));\n    }\n  },\n);\n\n/**\n * Refresh token and retry failed request\n */\nasync function refreshTokenAndRetry(originalRequest) {\n  try {\n    const refreshToken = localStorage.getItem(\"refreshToken\");\n    if (!refreshToken) throw new Error(\"No refresh token\");\n\n    const response = await axios.post(`${API_BASE_URL}/auth/refresh`, {\n      refreshToken,\n    });\n\n    const newToken = response.data.token;\n    localStorage.setItem(\"authToken\", newToken);\n\n    // Retry original request\n    originalRequest.headers.Authorization = `Bearer ${newToken}`;\n    return axios(originalRequest);\n  } catch (error) {\n    // Refresh failed, logout user\n    localStorage.removeItem(\"authToken\");\n    localStorage.removeItem(\"refreshToken\");\n    window.location.href = \"/\";\n    return Promise.reject(error);\n  }\n}\n\nexport const authAPI = {\n  register: (username, email, password, displayName) =>\n    apiClient.post(\"/auth/register\", {\n      username,\n      email,\n      password,\n      displayName,\n    }),\n\n  login: (username, password) =>\n    apiClient.post(\"/auth/login\", { username, password }),\n\n  refresh: (refreshToken) => apiClient.post(\"/auth/refresh\", { refreshToken }),\n\n  verify: () => apiClient.get(\"/auth/verify\"),\n};\n\nexport const userAPI = {\n  getProfile: (userId) => apiClient.get(`/users/${userId}`),\n\n  updateProfile: (updates) => apiClient.put(\"/users/profile\", updates),\n\n  getStats: (userId) => apiClient.get(`/users/${userId}/stats`),\n\n  getHistory: (userId, limit = 50) =>\n    apiClient.get(`/users/${userId}/history?limit=${limit}`),\n\n  getPreferences: () => apiClient.get(\"/users/preferences\"),\n\n  updatePreferences: (preferences) =>\n    apiClient.put(\"/users/preferences\", preferences),\n\n  unlockTheme: (themeName) => apiClient.post(`/users/themes/${themeName}`),\n};\n\nexport const gameAPI = {\n  create: (boardSize, gameMode, opponentId = null) =>\n    apiClient.post(\"/games/create\", { boardSize, gameMode, opponentId }),\n\n  get: (sessionId) => apiClient.get(`/games/${sessionId}`),\n\n  complete: (sessionId, data) =>\n    apiClient.post(`/games/${sessionId}/complete`, data),\n\n  recordMove: (sessionId, moveData) =>\n    apiClient.post(`/games/${sessionId}/moves`, moveData),\n\n  getMoves: (sessionId) => apiClient.get(`/games/${sessionId}/moves`),\n};\n\nexport const leaderboardAPI = {\n  get: (category, season = \"all_time\", limit = 100) =>\n    apiClient.get(`/leaderboards/${category}?season=${season}&limit=${limit}`),\n\n  getPosition: (category, season = \"all_time\") =>\n    apiClient.get(`/leaderboards/${category}/position?season=${season}`),\n};\n\nexport const achievementAPI = {\n  getAll: () => apiClient.get(\"/achievements\"),\n\n  getUserAchievements: (userId) =>\n    apiClient.get(`/users/${userId}/achievements`),\n};\n\nexport const powerupAPI = {\n  getAll: () => apiClient.get(\"/powerups\"),\n\n  getUserPowerups: () => apiClient.get(\"/users/powerups\"),\n\n  use: (powerupKey) => apiClient.post(`/powerups/${powerupKey}/use`),\n};\n\nexport const analyticsAPI = {\n  getSystemStats: () => apiClient.get(\"/analytics/system\"),\n};\n\n/**\n * Save auth tokens to localStorage\n */\nexport function saveTokens(token, refreshToken) {\n  localStorage.setItem(\"authToken\", token);\n  localStorage.setItem(\"refreshToken\", refreshToken);\n}\n\n/**\n * Remove auth tokens from localStorage\n */\nexport function clearTokens() {\n  localStorage.removeItem(\"authToken\");\n  localStorage.removeItem(\"refreshToken\");\n}\n\n/**\n * Check if user is authenticated\n */\nexport function isAuthenticated() {\n  return !!localStorage.getItem(\"authToken\");\n}\n\n/**\n * Get current auth token\n */\nexport function getToken() {\n  return localStorage.getItem(\"authToken\");\n}\n\nexport default apiClient;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}